{% extends "global/Page.html" %}
{% load static otree %}

{% block title %} Game Feedback {% endblock %}

{% block content %}

<div class="card bg-transparent">

  <div class="card-header">
    <h1>ENERGY GAME</h1>
  </div>

    <div class="card-body">
      <div class="card" style="background: #f2f2f2;">
        <div class="card-title game-title">MONTH {{ current_round }} ({{ current_month }})</div>
            <div class="card-body">
                <table id="table" class="table" style="text-align:left;">
                    <tr style="background: linear-gradient(to right,#EFF0F0,#b5b5b5)">
                        <th></th>
                        <th></th>
                        <th></th>
                        <th>{{ current_month }}</th>
                        <th>Cumulative to date</th>
                        <th></th>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td>Your contribution to your personal account:</td>
                        <td>
                            <e style="color: #a700a8">{{ player.private_contribution }}</e>
                        </td>
                        <td>
                            <e style="color: #a700a8">{{ player.all_rounds_private_contribution }}</e>
                        </td>
                        <td></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td><B>Your contribution to the group conservation account:</B></td>
                        <td>
                            <e style="color: #0000ff">{{ player.contribution}}</e>
                        </td>
                        <td>
                            <e style="color: #0000ff">{{ player.all_rounds_contribution }}</e>
                        </td>
                    </tr>

                    <tr>
                        <td></td>
                        <td></td>
                        <td><b>Others' residents total contributions to the group conservation account:</b></td>
                        <td>
                            <e style="color: #0000ff"> {{ player.others_contribution }} </e>
                        </td>
                        <td>
                            <e style="color: #0000ff"> {{ player.all_rounds_others_contribution }} </e>
                        </td>
                        <td></td>
                    </tr>

                    <tr>
                        <td></td>
                        <td></td>
                        <td><b>Total group conservation account contributions:</b></td>
                        <td>
                          <e style="color: #0000ff">{{ group.total_contribution }}</e>
                        </td>
                        <td>
                          <e style="color: #0000ff">{{ group.all_rounds_contribution }}</e>
                        </td>
                        <td id="percentage"></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    {% include './blocks/next-button.html' %}
</div>
<script>
  var percentage = document.getElementById("percentage")
var value = Math.floor(parseInt("{{ group.all_rounds_contribution }}".split(" ")[0], 10) * 100 / 900)
percentage.innerHTML = "<b><e style=\"color: #0000ff\">" + value + "% of the annual energy <br>reduction goal of 60% (900)</e></b>"

let user_id = parseInt("{{ player.id_in_group }}");
let user_contribution = parseInt("{{ player.contribution }}");
let user_total_contribution = parseInt("{{ player.all_rounds_contribution }}");
let raw_contribution_string = "{{ player.contribution }}"
let player_contribution = parseInt(raw_contribution_string.split(" ")[0])
let current_round = {{ player.round_number }} - 2
let all_rounds_contribution = {{ session.vars.bot_contributions }}
let current_round_contributions = all_rounds_contribution[current_round]
// let total_contributions = {{ session.vars.bot_contributions }}
// console.log("cumulative contributions")
// console.log(total_contributions)
// total_contributions = total_contributions[current_round]

let cumulative_contributions = []
// fill in first round
      // let first_round = all_rounds_contribution[0].slice(0)
      // cumulative_contributions.push(first_round)
      //
      // // fill in all subsequent rounds
      // for (let i = 1; i < all_rounds_contribution.length; ++i) {
      //     let cumulative_current_round = []
      //     for (let j = 0; j < all_rounds_contribution[i].length; ++j) {
      //         term = cumulative_contributions[i - 1][j] + all_rounds_contribution[i][j]
      //         cumulative_current_round.push(term)
      //     }
      //     cumulative_contributions.push(cumulative_current_round)
      // }
      //
      // // add it to the table
      // let table = document.getElementById("table");
      // let current_round_cumulative = cumulative_contributions[current_round]
      // for (let i = 0; i < current_round_contributions.length; i++) {
      //     gameTableAddRow(table, i + 2, current_round_contributions[i], current_round_cumulative[i]);
      // }


</script>

{% endblock %}
