{% extends "blocks/main-card.html" %}
{% load static otree %}

{% block page_title %}{{ page_title }}{% endblock %}

{% block page_content %}
<div class="card game-card z1">
  <h2 class="card-title game-title">MONTH {{ current_round }} ({{ current_month }})</h2>

  <div class="card-body">
    <table id="table" class="table" style="text-align:left;">
      <tr style="background: linear-gradient(to right,#EFF0F0,#b5b5b5)">
        <th></th>
        <th></th>
        <th></th>
        <th>{{ current_month }}</th>
        <th>Cumulative to date</th>
        <th></th>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td class="text-left"><span class="row-title">Your contribution to your personal account:</span></td>
        <td class="text-center"><span class="color-private">{{ player.private_contribution }}</span></td>
        <td class="text-center"><span class="color-private">{{ player.all_rounds_private_contribution }}</span></td>
        <td></td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td class="text-left"><span class="row-title">Your contribution to the group conservation account:</span></td>
        <td class="text-center"><span class="color-conserve">{{ player.contribution}}</span></td>
        <td class="text-center"><span class="color-conserve">{{ player.all_rounds_contribution }}</span></td>
        <td></td>
      </tr>

      <tr>
        <td></td>
        <td></td>
        <td class="text-left"><span class="row-title">Others' residents total contributions to the group conservation account:</span></td>
        <td class="text-center"><span class="color-conserve">{{ total_contribution }}</span></td>
        <td class="text-center"><span class="color-conserve">{{ player.all_rounds_others_contribution }}</span></td>
        <td id-="token_avg"><span class="">(Avg: {{ avg_contrib }})</span></td>
      </tr>

      <tr>
        <td></td>
        <td></td>
        <td class="text-left"><span class="row-title">Total group conservation account contributions:</span></td>
        <td class="text-center"><span class="color-conserve">{{ group.total_contribution }}</span></td>
        <td class="text-center"><span class="color-conserve">{{ group.all_rounds_contribution }}</span></td>
        <td><span id="percentage" class="color-conserve"></span></td>
      </tr>
    </table>
  </div>
</div>
<script>
let user_id = parseInt("{{ player.id_in_group }}");
let current_round = {{ player.round_number }} - 2
let user_contribution = parseInt("{{ player.contribution }}");
let raw_contribution_string = "{{ player.contribution }}"
let player_contribution = parseInt(raw_contribution_string.split(" ")[0])
let user_total_contribution = parseInt("{{ player.all_rounds_contribution }}");
let all_rounds_contribution = {{ session.vars.bot_contributions }}
let current_round_contributions = all_rounds_contribution[current_round]
let total_contributions = {{ session.vars.bot_contributions }}
var group_total_string = "{{ group.all_rounds_contribution }}";
var group_total = parseInt(group_total_string.split(" ")[0], 10)
var prct_to_goal = Math.floor(group_total * 100 / 900);
var percentage = document.getElementById("percentage")
percentage.innerHTML = `${group_total} /900 = ${prct_to_goal}% of goal met`;
console.log(total_contributions)
total_contributions = total_contributions[current_round]
let cumulative_contributions = []
</script>

{% endblock %}
